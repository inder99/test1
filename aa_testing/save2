<?php
if(count($_POST)>0) {
    
	/* Form Required Field Validation */
    
	foreach($_POST as $key=>$value) {
	if(empty($_POST[$key])) {
	$message = ucwords($key) . " field is required";
	break;
	}
	}
    
	/* Password Matching Validation */
	if($_POST['stu_password'] != $_POST['confirm_password']){ 
	$message = 'Passwords should be same<br>'; 
	}

	/* Email Validation 
	if(!isset($message)) {
	if (!filter_var($_POST["stu_email"], FILTER_VALIDATE_EMAIL)) {
	$message = "Invalid UserEmail";
	}
	}
*/
	/* Validation to check if gender is selected 
	if(!isset($message)) {
	if(!isset($_POST["gender"])) {
	$message = " Gender field is required";
	}
	}
*/
	/* Validation to check if Terms and Conditions are accepted 
	if(!isset($message)) {
	if(!isset($_POST["terms"])) {
	$message = "Accept Terms and conditions before submit";
	}
	}
*/
	if(!isset($message)) {
		require_once("dbcontroller.php");
		$db_handle = new DBController();
		$query = "SELECT * FROM registered_users1 where email = '" . $_POST["stu_email"] . "'";
		$count = $db_handle->numRows($query);
		
		if($count==0) {
			$query = "INSERT INTO registered_users1 ( stu_email,stu_password) VALUES
			('" . $_POST["stu_email"] . "','" . md5($_POST["stu_password"]) . "')";
			$current_id = $db_handle->insertQuery($query);
            
/*			if(!empty($current_id)) {
				$actual_link = "http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]"."activate.php?id=" . $current_id;
				$toEmail = $_POST["userEmail"];
				$subject = "User Registration Activation Email";
				$content = "Click this link to activate your account. <a href='" . $actual_link . "'>" . $actual_link . "</a>";
				$mailHeaders = "From: Admin\r\n";
				if(mail($toEmail, $subject, $content, $mailHeaders)) {
					$message = "You have registered and the activation mail is sent to your email. Click the activation link to activate you account.";	
				}
				unset($_POST);
			} else {
				$message = "Problem in registration. Try Again!";	
			}
*/            
		} else {
			$message = "User Email is already in use.";	
		}
	}
}
?>
<html>
<head>
<title>SignUp Student</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
<link rel="stylesheet" href="./signup/css/style.css"> 
</head>
<body>
<form  id="msform" name="student_reg" class="ms_form_left" role="form"  method="post" action="" autocomplete="on">
<?php if(isset($message)) { ?>
<div class="message"><?php echo $message; ?></div>
<?php } ?>
        <!-- progressbar -->
        <ul id="progressbar">
            <li class="active">Account Setup</li>
            <li>Personal Details</li>            
            <li>Academics</li>
        </ul>
        <!-- fieldsets -->
        <!-- /***************************   Sign Up   ***********************************************/    -->    
        
            <h2 class="fs-title">Create your account</h2>
            <h3 class="fs-subtitle">This is step 1</h3>
            <label style="text-align:left;">Email</label>
            <input type="email" name="stu_email" placeholder="Email" value="<?php if(isset($_POST['stu_email'])) echo $_POST['stu_email']; ?>" onblur="ValidateEmail(this);" autofocus required/>             
            <label class="align_left">Password</label>
            <input type="password" name="stu_password" placeholder="Password" onblur="ValidatePassword(this);" required/>
            <label class="align_left">Confirm Password</label>            
            <input type="password" name="confirm_password" placeholder="Confirm Password" onblur="ConfirmPassword(this);" required/>
            <input type="submit" name="submit" value="Next"/>
            
        
</form>
    
<script src='./js/jquery.min.js'></script>
<script src='./js/javascript.js'></script>
<script src='http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js'></script>
<script src="./signup/js/index.js"></script>
    
</body>
</html>
